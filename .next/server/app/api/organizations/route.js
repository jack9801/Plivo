"use strict";(()=>{var e={};e.id=2995,e.ids=[2995],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},57727:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>m,originalPathname:()=>E,patchFetch:()=>v,requestAsyncStorage:()=>p,routeModule:()=>d,serverHooks:()=>f,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>h});var n={};t.r(n),t.d(n,{GET:()=>u,POST:()=>l});var o=t(95419),i=t(69108),a=t(99678),s=t(78070),c=t(47033);async function u(){try{let e=await c._B.organization.findMany({orderBy:{createdAt:"desc"}});return s.Z.json(e)}catch(e){return console.error("Error fetching organizations:",e),s.Z.json({error:"Failed to fetch organizations"},{status:500})}}async function l(e){try{let{name:r,slug:n,defaultEmail:o}=await e.json();if(!r||!n)return s.Z.json({error:"Missing required fields"},{status:400});if(await c._B.organization.findUnique({where:{slug:n}}))return s.Z.json({error:"Organization with this slug already exists"},{status:400});let i=t(6113).randomBytes(32).toString("hex"),a=await c._B.$transaction(async e=>{let t=await e.organization.create({data:{name:r,slug:n}});if(o){console.log(`Creating default subscription for organization ${t.name} (${t.id}) with email ${o}`);let r=await e.subscription.create({data:{email:o,organizationId:t.id,token:i,confirmed:!0}});return console.log(`Default subscription created with ID ${r.id}`),{organization:t,subscription:r}}return{organization:t,subscription:null}});return s.Z.json({...a.organization,defaultSubscription:a.subscription?{email:a.subscription.email,confirmed:a.subscription.confirmed,id:a.subscription.id}:null},{status:201})}catch(e){return console.error("Error creating organization:",e),s.Z.json({error:"Failed to create organization",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/organizations/route",pathname:"/api/organizations",filename:"route",bundlePath:"app/api/organizations/route"},resolvedPagePath:"C:\\Pliv\\app\\api\\organizations\\route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:p,staticGenerationAsyncStorage:g,serverHooks:f,headerHooks:m,staticGenerationBailout:h}=d,E="/api/organizations/route";function v(){return(0,a.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:g})}},47033:(e,r,t)=>{t.d(r,{_B:()=>s,wv:()=>c});var n=t(53524);let o=(()=>{try{if("undefined"!=typeof process&&"1"===process.env.VERCEL)return!0;return!1}catch(e){return!1}})(),i="phase-production-build"===process.env.NEXT_PHASE||process.env.VERCEL&&"production"===process.env.NEXT_PUBLIC_VERCEL_ENV||process.env.VERCEL_ENV||o,a={log:["error"],errorFormat:"minimal"},s=global.prisma||(()=>{if(i)return console.log("Static generation detected, using mock database client"),new Proxy({},{get:(e,r)=>"$connect"===r||"$disconnect"===r?async()=>{}:()=>new Proxy({},{get:()=>()=>Promise.resolve([]),apply:()=>Promise.resolve([])})});try{return console.log("Creating Prisma client for runtime with DATABASE_URL:",process.env.DATABASE_URL?process.env.DATABASE_URL.substring(0,process.env.DATABASE_URL.indexOf("@"))+"****":"undefined"),new n.PrismaClient(a)}catch(e){throw console.error("Error creating Prisma client:",e),e}})();async function c(e,r){try{if(i)return console.log("Static generation detected, returning fallback data"),r;return await e()}catch(e){return console.error("Database operation failed:",e),r}}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[1638,6206],()=>t(57727));module.exports=n})();