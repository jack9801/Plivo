"use strict";(()=>{var e={};e.id=2267,e.ids=[2267],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},42989:(e,r,o)=>{o.r(r),o.d(r,{headerHooks:()=>v,originalPathname:()=>w,patchFetch:()=>S,requestAsyncStorage:()=>m,routeModule:()=>f,serverHooks:()=>y,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>E});var n={};o.r(n),o.d(n,{POST:()=>p,dynamic:()=>g});var t=o(95419),s=o(69108),a=o(99678),i=o(78070),c=o(47033),l=o(6521),u=o(7439),d=o(3205);let g="force-dynamic";async function p(e){try{try{await c._B.$queryRaw`SELECT 1`,console.log("[Sign In] Database connection confirmed")}catch(e){return console.error("[Sign In] Database connection failed:",e),i.Z.json({error:"Database connection failed",details:e.message},{status:500})}let{email:r,password:o}=await e.json();if(console.log(`[Sign In] Attempt for email: ${r}`),!r||!o)return console.log("[Sign In] Missing email or password"),i.Z.json({error:"Email and password are required"},{status:400});try{let e=await c._B.user.findUnique({where:{email:r}});if(!e)return console.log(`[Sign In] User not found: ${r}`),i.Z.json({error:"Invalid email or password"},{status:401});console.log(`[Sign In] User found: ${r}, verifying password`);try{if(!await l.compare(o,e.password))return console.log(`[Sign In] Invalid password for: ${r}`),i.Z.json({error:"Invalid email or password"},{status:401});console.log(`[Sign In] Password valid for: ${r}, creating token`);try{let o=(0,d.V3)({userId:e.id,email:e.email});console.log(`[Sign In] Token created for: ${r}, setting cookie`),(0,u.cookies)().set({name:"__clerk_db_jwt",value:o,httpOnly:!0,path:"/",secure:!0,maxAge:604800,sameSite:"lax"});let{password:n,...t}=e;return console.log(`[Sign In] Success for: ${r}`),i.Z.json({user:t,success:!0})}catch(e){throw console.error(`[Sign In] Token creation error for ${r}:`,e),Error(`Token creation failed: ${e.message}`)}}catch(e){throw console.error(`[Sign In] Password comparison error for ${r}:`,e),Error(`Password comparison failed: ${e.message}`)}}catch(e){throw console.error(`[Sign In] Database error for ${r}:`,e),Error(`Database operation failed: ${e.message}`)}}catch(e){return console.error("Error authenticating user:",e),i.Z.json({error:"Authentication failed",details:e.message},{status:500})}}let f=new t.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/auth/signin/route",pathname:"/api/auth/signin",filename:"route",bundlePath:"app/api/auth/signin/route"},resolvedPagePath:"C:\\Pliv\\app\\api\\auth\\signin\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:y,headerHooks:v,staticGenerationBailout:E}=f,w="/api/auth/signin/route";function S(){return(0,a.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:h})}},3205:(e,r,o)=>{o.d(r,{V3:()=>s,WX:()=>a});var n=o(46082);function t(){let e=process.env.CLERK_SECRET_KEY||process.env.JWT_SECRET||"fallback-secret-key-change-me";return"fallback-secret-key-change-me"===e&&console.warn("WARNING: Using fallback secret key. Set CLERK_SECRET_KEY or JWT_SECRET environment variable."),e}function s(e){let r=t();try{console.log(`Creating token for user: ${e.userId}`);let o=(0,n.sign)(e,r,{expiresIn:"7d"});try{return(0,n.verify)(o,r),console.log(`Token created and verified successfully for user: ${e.userId}`),o}catch(e){throw console.error("Token verification after creation failed:",e),e}}catch(e){throw console.error("Token creation failed:",e),e}}function a(e){try{console.log("Verifying token...");let r=t(),o=(0,n.verify)(e,r);return console.log(`Token verified successfully for user: ${o.userId}`),o}catch(e){return console.error("Error verifying token:",e),null}}},47033:(e,r,o)=>{o.d(r,{_B:()=>a,wv:()=>i});var n=o(53524);let t=(()=>{try{if("undefined"!=typeof process&&"1"===process.env.VERCEL)return!0;return!1}catch(e){return!1}})(),s="phase-production-build"===process.env.NEXT_PHASE||process.env.VERCEL&&"production"===process.env.NEXT_PUBLIC_VERCEL_ENV||process.env.VERCEL_ENV||t,a=global.prisma||(s?(console.log("Static generation detected, using mock database client"),new Proxy({},{get:(e,r)=>"$connect"===r||"$disconnect"===r?async()=>{}:()=>new Proxy({},{get:()=>()=>Promise.resolve([]),apply:()=>Promise.resolve([])})})):new n.PrismaClient({log:["error"]}));async function i(e,r){try{if(s)return console.log("Static generation detected, returning fallback data"),r;return await e()}catch(e){return console.error("Database operation failed:",e),r}}}};var r=require("../../../../webpack-runtime.js");r.C(e);var o=e=>r(r.s=e),n=r.X(0,[1638,6206,7439,6082,6521],()=>o(42989));module.exports=n})();